---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
  searchParams?: URLSearchParams;
}

const { currentPage, totalPages, baseUrl, searchParams } = Astro.props;

// Generate pagination URLs
function generatePageUrl(page: number): string {
  const params = new URLSearchParams(searchParams || '');
  params.set('page', page.toString());
  return `${baseUrl}?${params.toString()}`;
}

// Calculate visible page numbers
function getVisiblePages(current: number, total: number): (number | string)[] {
  const pages: (number | string)[] = [];
  
  if (total <= 7) {
    // Show all pages if total is 7 or less
    for (let i = 1; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);
    
    if (current > 4) {
      pages.push('...');
    }
    
    // Show pages around current page
    const start = Math.max(2, current - 1);
    const end = Math.min(total - 1, current + 1);
    
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    
    if (current < total - 3) {
      pages.push('...');
    }
    
    // Always show last page
    if (total > 1) {
      pages.push(total);
    }
  }
  
  return pages;
}

const visiblePages = getVisiblePages(currentPage, totalPages);
---

{totalPages > 1 && (
  <div class="flex justify-center mt-8">
    <div class="join">
      <!-- Previous button -->
      {currentPage > 1 ? (
        <a href={generatePageUrl(currentPage - 1)} class="join-item btn btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Previous
        </a>
      ) : (
        <button class="join-item btn btn-outline btn-disabled">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Previous
        </button>
      )}
      
      <!-- Page numbers -->
      {visiblePages.map(page => {
        if (page === '...') {
          return <span class="join-item btn btn-outline btn-disabled">...</span>;
        }
        
        const pageNum = page as number;
        if (pageNum === currentPage) {
          return <span class="join-item btn btn-primary">{pageNum}</span>;
        }
        
        return (
          <a href={generatePageUrl(pageNum)} class="join-item btn btn-outline">
            {pageNum}
          </a>
        );
      })}
      
      <!-- Next button -->
      {currentPage < totalPages ? (
        <a href={generatePageUrl(currentPage + 1)} class="join-item btn btn-outline">
          Next
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      ) : (
        <button class="join-item btn btn-outline btn-disabled">
          Next
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      )}
    </div>
  </div>
)}

<!-- Page info -->
{totalPages > 1 && (
  <div class="text-center mt-4 text-sm text-base-content/70">
    Page {currentPage} of {totalPages}
  </div>
)}