---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
  searchParams?: URLSearchParams;
  totalItems?: number;
  itemsPerPage?: number;
}

const { currentPage, totalPages, baseUrl, searchParams, totalItems, itemsPerPage } = Astro.props;

// Validate props
const validCurrentPage = Math.max(1, Math.min(currentPage, totalPages));
const validTotalPages = Math.max(1, totalPages);

// Generate pagination URLs
function generatePageUrl(page: number): string {
  const params = new URLSearchParams(searchParams || '');
  params.set('page', page.toString());
  return `${baseUrl}?${params.toString()}`;
}

// Calculate visible page numbers with improved logic
function getVisiblePages(current: number, total: number): (number | string)[] {
  const pages: (number | string)[] = [];
  
  if (total <= 1) {
    return [1];
  }
  
  if (total <= 7) {
    // Show all pages if total is 7 or less
    for (let i = 1; i <= total; i++) {
      pages.push(i);
    }
  } else {
    // Always show first page
    pages.push(1);
    
    // Add ellipsis if needed
    if (current > 4) {
      pages.push('...');
    }
    
    // Show pages around current page
    const start = Math.max(2, current - 1);
    const end = Math.min(total - 1, current + 1);
    
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    
    // Add ellipsis if needed
    if (current < total - 3) {
      pages.push('...');
    }
    
    // Always show last page if it's not already included
    if (total > 1 && !pages.includes(total)) {
      pages.push(total);
    }
  }
  
  return pages;
}

const visiblePages = getVisiblePages(validCurrentPage, validTotalPages);

// Calculate item range for display
const startItem = totalItems ? Math.min((validCurrentPage - 1) * (itemsPerPage || 12) + 1, totalItems) : null;
const endItem = totalItems ? Math.min(validCurrentPage * (itemsPerPage || 12), totalItems) : null;
---

{validTotalPages > 1 && (
  <div class="flex justify-center mt-8">
    <div class="join">
      <!-- Previous button -->
      {validCurrentPage > 1 ? (
        <a href={generatePageUrl(validCurrentPage - 1)} class="join-item btn btn-outline" aria-label="Previous page">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Previous
        </a>
      ) : (
        <button class="join-item btn btn-outline btn-disabled" aria-label="Previous page (disabled)">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Previous
        </button>
      )}
      
      <!-- Page numbers -->
      {visiblePages.map(page => {
        if (page === '...') {
          return <span class="join-item btn btn-outline btn-disabled" aria-label="More pages">...</span>;
        }
        
        const pageNum = page as number;
        if (pageNum === validCurrentPage) {
          return <span class="join-item btn btn-primary" aria-current="page">{pageNum}</span>;
        }
        
        return (
          <a href={generatePageUrl(pageNum)} class="join-item btn btn-outline" aria-label={`Go to page ${pageNum}`}>
            {pageNum}
          </a>
        );
      })}
      
      <!-- Next button -->
      {validCurrentPage < validTotalPages ? (
        <a href={generatePageUrl(validCurrentPage + 1)} class="join-item btn btn-outline" aria-label="Next page">
          Next
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      ) : (
        <button class="join-item btn btn-outline btn-disabled" aria-label="Next page (disabled)">
          Next
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      )}
    </div>
  </div>
)}

<!-- Page info with improved display -->
{validTotalPages > 1 && (
  <div class="text-center mt-4 space-y-1">
    <div class="text-sm text-base-content/70">
      Page {validCurrentPage} of {validTotalPages}
    </div>
    {totalItems && startItem && endItem && (
      <div class="text-xs text-base-content/60">
        Showing {startItem.toLocaleString()}-{endItem.toLocaleString()} of {totalItems.toLocaleString()} items
      </div>
    )}
  </div>
)}